// <copyright file="OpenAiGenericStrategy.cs" company="PlaceholderCompany">
// Copyright (c) PlaceholderCompany. All rights reserved.
// </copyright>

namespace Synaxis.InferenceGateway.Infrastructure.ChatClients.Strategies
{
    using System.Collections.Generic;
    using System.Threading;
    using System.Threading.Tasks;
    using Microsoft.Extensions.AI;
    using Synaxis.InferenceGateway.Application.ChatClients.Strategies;

    public class OpenAiGenericStrategy : IChatClientStrategy
    {
        private static readonly HashSet<string> SupportedTypes = new ()
        {
            "OpenAI", "Groq", "OpenRouter", "Pollinations", "Gemini", "Nvidia", "HuggingFace", "Cohere",
        };

        public bool CanHandle(string providerType) => SupportedTypes.Contains(providerType);

        public async Task<ChatResponse> ExecuteAsync(
            IChatClient client,
            IEnumerable<ChatMessage> messages,
            ChatOptions options,
            CancellationToken ct)
        {
            return await client.GetResponseAsync(messages, options, ct).ConfigureAwait(false);
        }

        public IAsyncEnumerable<ChatResponseUpdate> ExecuteStreamingAsync(
            IChatClient client,
            IEnumerable<ChatMessage> messages,
            ChatOptions options,
            CancellationToken ct)
        {
            return client.GetStreamingResponseAsync(messages, options, ct);
        }
    }
}
